<!-- plugin.html - 剧情助手 (独立 API 版 - 带模型列表) -->
<div id="st-story-helper" class="sh-panel" role="dialog" aria-label="剧情助手">
    <header class="sh-header">
        <div class="sh-title">
            <svg class="sh-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 18h6M10 21h4M12 2a6 6 0 0 0-4 10c0 2 1 3 1 4h6c0-1 1-2 1-4a6 6 0 0 0-4-10z"/>
            </svg>
            <span>剧情助手 (独立版)</span>
        </div>
        <div class="sh-header-actions">
            <button id="sh-settings-toggle" class="sh-icon-btn" title="API 设置">⚙️</button>
            <button id="sh-close" class="sh-icon-btn" title="关闭">✕</button>
        </div>
    </header>

    <!-- 设置面板 (默认隐藏) -->
    <div id="sh-settings-panel" class="sh-settings-panel" style="display:none;">
        <div class="sh-settings-group">
            <label>API 地址 (Base URL)</label>
            <input type="text" id="sh-api-url" class="sh-input" placeholder="例如: https://api.openai.com/v1">
            <div class="sh-hint">本地示例: http://127.0.0.1:5000/v1</div>
        </div>
        <div class="sh-settings-group">
            <label>API Key</label>
            <input type="password" id="sh-api-key" class="sh-input" placeholder="sk-...">
        </div>
        
        <!-- 修改部分开始：带刷新按钮的模型选择器 -->
        <!-- plugin.html 修改片段：模型名称部分 -->
<div class="sh-settings-group">
    <label>模型名称 (Model)</label>
    <div style="display:flex; gap:6px;">
        <!-- 改为 select 标签，实现标准的不可编辑下拉框 -->
        <select id="sh-api-model" class="sh-input" style="flex:1; cursor:pointer;">
            <option value="gpt-3.5-turbo">gpt-3.5-turbo (默认)</option>
        </select>
        <button id="sh-refresh-models" class="sh-btn secondary" style="padding:0 10px; min-width:40px; display:flex; align-items:center; justify-content:center;" title="获取模型列表">↻</button>
    </div>
</div>
        <!-- 修改部分结束 -->

        <button id="sh-save-settings" class="sh-btn primary full-width">保存连接设置</button>
    </div>

    <main class="sh-body">
        <section class="sh-section sh-left">
            <label class="sh-label">自定义提示词</label>
            <textarea id="sh-prompt" class="sh-textarea" placeholder="在此输入 prompt..."></textarea>
            
            <div class="sh-row">
                <button id="sh-save-prompt" class="sh-btn ghost">保存提示词</button>
                <button id="sh-load-sample" class="sh-btn ghost">载入示例</button>
                <div id="sh-prompt-status" class="sh-note"></div>
            </div>

            <label class="sh-label">上下文 (自动读取或手动粘贴)</label>
            <textarea id="sh-context" class="sh-textarea small" placeholder="留空则自动读取最近聊天记录..."></textarea>

            <div class="sh-row">
                <button id="sh-generate" class="sh-btn primary">生成剧情走向</button>
                <div id="sh-gen-status" class="sh-note">准备就绪</div>
            </div>
        </section>

        <aside class="sh-section sh-right">
            <div class="sh-subtitle">生成选项</div>
            <div id="sh-options" class="sh-options">
                <div class="sh-empty">请先配置右上角 ⚙️ 设置，然后点击生成。</div>
            </div>

            <div class="sh-divider"></div>
            <div class="sh-subtitle">预览/填入</div>
            <textarea id="sh-target-preview" class="sh-textarea small"></textarea>

            <div class="sh-row">
                <button id="sh-apply-to-st" class="sh-btn primary">填入输入框</button>
                <button id="sh-clear-preview" class="sh-btn ghost">清空</button>
                <div id="sh-last" class="sh-note"></div>
            </div>
        </aside>
    </main>
</div>

